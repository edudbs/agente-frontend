<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agente de Agenda Inteligente</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> 
    <style>
        /* --- ESTILOS PARA TEMA ESCURO --- */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 20px; 
            background-color: #1a1a2e; /* Fundo muito escuro */
            color: #e0e0e0; /* Texto claro padr√£o */
        }
        .container { 
            max-width: 700px; 
            margin: 0 auto; 
            background: #2a2a4a; /* Fundo do container ligeiramente mais claro */
            padding: 25px; 
            border-radius: 12px; 
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }
        h1 { 
            color: #92e6a7; /* Verde claro para o t√≠tulo */
            text-align: center; 
            margin-bottom: 20px; 
        }
        #chat-area { 
            border: 1px solid #4a4a6e;
            padding: 15px; 
            height: 350px; 
            overflow-y: auto; 
            margin-bottom: 15px; 
            background-color: #24243e; /* Fundo da √°rea de chat */
            border-radius: 8px; 
            line-height: 1.6; 
        }
        .user-message { 
            text-align: right; 
            margin: 10px 0; 
            padding: 8px 12px; 
            background-color: #005f99; /* Azul escuro para mensagens do usu√°rio */
            color: #ffffff; 
            border-radius: 15px 15px 0 15px; 
            max-width: 80%; 
            margin-left: auto; 
        }
        .agent-message { 
            text-align: left; 
            margin: 10px 0; 
            padding: 10px 15px; 
            background-color: #4a4a6e; /* Fundo escuro do agente */
            color: #e0e0e0; 
            border-radius: 15px 15px 15px 0; 
            max-width: 80%; 
        }
        .agent-message ul, .agent-message ol { 
            padding-left: 20px; 
            margin: 5px 0; 
            color: #c0c0c0;
        }
        
        #command-input { 
            width: calc(100% - 100px); 
            padding: 12px; 
            box-sizing: border-box; 
            border: 1px solid #92e6a7; 
            border-radius: 20px 0 0 20px; 
            outline: none; 
            display: inline-block; 
            background-color: #3a3a5a; /* Fundo do input */
            color: #e0e0e0; /* Texto digitado */
        }
        #command-input::placeholder {
            color: #a0a0b0; /* Cor do placeholder */
        }
        button { 
            width: 100px; 
            padding: 12px; 
            background-color: #92e6a7; /* Verde claro para o bot√£o */
            color: #1a1a2e; /* Texto escuro no bot√£o */
            border: none; 
            cursor: pointer; 
            border-radius: 0 20px 20px 0; 
            display: inline-block; 
            margin-left: -5px; 
        }
        button:hover { 
            background-color: #7bd48f; 
        }
        .input-group { 
            display: flex; 
        }
        .error { 
            color: #ff6b6b; 
            font-weight: bold; 
        }
        small { 
            display: block; 
            margin-top: 5px; 
            color: #a0a0b0; 
            font-size: 0.8em; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóìÔ∏è Seu Agente de Agenda</h1>
        
        <div id="chat-area">
            <div class="agent-message"><p><strong>Agente:</strong> Ol√°! Seu agente de planejamento est√° online. Pergunte sobre sua agenda ou me pe√ßa para agendar algo!</p></div>
        </div>
        
        <div class="input-group">
            <input type="text" id="command-input" placeholder="Ex: Sugira minha programa√ß√£o de amanh√£" required>
            <button onclick="sendCommand()">Enviar</button>
        </div>
        
        <p style="margin-top: 15px; font-size: 0.7em; text-align: center;">URL: <span id="api-url-display"></span></p>
    </div>

    <script>
        // --- CONFIGURA√á√ÉO ---
        const API_BASE_URL = "https://agente-planejamento.onrender.com"; // EX: "https://seu-projeto.onrender.com"
        const API_TOKEN = "tk_pergunta"; // EX: "seutokensecreto123"
        
        const chatArea = document.getElementById('chat-area');
        const input = document.getElementById('command-input');
        
        document.getElementById('api-url-display').textContent = API_BASE_URL + "/chat";

        function appendMessage(sender, text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'user' ? 'user-message' : 'agent-message';
            
            const messageText = document.createElement('p');
            
            if (sender === 'agent') {
                // USA MARKED.JS PARA CONVERTER O MARKDOWN EM HTML (LISTAS, NEGRITO)
                messageText.innerHTML = `<strong>Agente:</strong> ${marked.parse(text)}`;
            } else {
                messageText.innerHTML = `<strong>Voc√™:</strong> ${text}`;
            }

            messageDiv.appendChild(messageText);
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        async function sendCommand() {
            const query = input.value.trim();
            if (!query) return;

            appendMessage('user', query);
            input.value = '';

            const encodedQuery = encodeURIComponent(query);
            const url = `${API_BASE_URL}/chat?query=${encodedQuery}&token=${API_TOKEN}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (response.ok) {
                    let agentResponse = data.answer;
                    
                    // Adiciona info de diagn√≥stico
                    let diagnosticInfo = '';
                    if (data.function_used) {
                        diagnosticInfo = `Fun√ß√£o usada: ${data.function_used}`;
                    } else if (data.function_used === null) {
                        diagnosticInfo = `A√ß√£o realizada com sucesso.`; 
                    }
                    
                    // Concatena a resposta do Gemini com a informa√ß√£o de diagn√≥stico
                    appendMessage('agent', agentResponse + `\n\n<small>${diagnosticInfo}</small>`);

                } else {
                    appendMessage('agent', `<span class="error">ERRO (${response.status}): ${data.detail || "Falha ao processar comando."}</span>`);
                }

            } catch (error) {
                console.error("Erro de comunica√ß√£o:", error);
                appendMessage('agent', `<span class="error">ERRO DE COMUNICA√á√ÉO: Verifique a URL Base e o Token.</span>`);
            }
        }
        
        input.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                sendCommand();
            }
        });
    </script>
</body>
</html>
